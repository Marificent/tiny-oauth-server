databases:
  - name: tinyoauth-db
    databaseName: tinyoauth
    plan: free

services:
  - type: web
    name: tinyoauth-api
    env: node
    plan: free
    rootDir: .
    buildCommand: npm ci
    startCommand: npm start
    healthCheckPath: /healthz
    autoDeploy: true
    envVars:
      - key: PORT
        value: "10000"
      - key: DATABASE_URL
        fromDatabase:
          name: tinyoauth-db
          property: connectionString
      - key: ISSUER_URL
        value: "https://tiny-oauth-server.onrender.com"
      - key: TOKEN_TTL_SEC
        value: "900"
      - key: REFRESH_TTL_DAYS
        value: "30"
      - key: REQUIRE_PKCE_PUBLIC
        value: "true"
      - key: ALLOW_PUBLIC_CLIENTS
        value: "true"
      - key: JWKS_KID
        value: "kid-1"
      - key: JWT_PRIVATE_KEY_PEM
        sync: false
